# Test Design: Story 2.4 - Ultra-Simple Member Management

Date: 2025-01-10
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 52
- Unit tests: 18 (35%)
- Integration tests: 21 (40%)
- E2E tests: 13 (25%)
- Priority distribution: P0: 19, P1: 20, P2: 13

## Test Level Rationale

The test distribution follows a balanced pyramid approach with emphasis on integration testing due to the data-centric nature of member management. Unit tests focus on validation logic and utilities, integration tests verify database operations and API functionality, while E2E tests validate critical user journeys.

## Test Scenarios by Acceptance Criteria

### AC1: Simple member registration form with invitation system

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-001 | Unit        | P0       | Validate member registration schema    | Pure validation logic for form inputs     |
| 2.4-UNIT-002 | Unit        | P0       | Validate email format                  | Critical data validation                  |
| 2.4-UNIT-003 | Unit        | P1       | Validate phone number format           | Input validation logic                    |
| 2.4-INT-001  | Integration | P0       | Create member with all fields          | Database operation verification           |
| 2.4-INT-002  | Integration | P0       | Create invitation on registration      | Multi-table transaction                  |
| 2.4-E2E-001  | E2E         | P0       | Complete member registration flow      | Critical user journey                    |

### AC2: Manual input or automatic member ID generation

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-004 | Unit        | P0       | Member ID format validation            | Input validation for manual IDs           |
| 2.4-INT-003  | Integration | P0       | Auto-generate sequential member ID     | Database sequence generation              |
| 2.4-INT-004  | Integration | P0       | Handle concurrent ID generation        | Race condition mitigation (DATA-001)      |
| 2.4-INT-005  | Integration | P1       | Accept manual member ID input          | Database constraint validation            |
| 2.4-E2E-002  | E2E         | P1       | Toggle between manual/auto ID modes    | UI interaction flow                       |

### AC3: Basic member search by member ID, name or email

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-005 | Unit        | P1       | Search term sanitization               | Prevent injection attacks (SEC-001)       |
| 2.4-INT-006  | Integration | P0       | Search by member ID                    | Core search functionality                 |
| 2.4-INT-007  | Integration | P0       | Search by email                        | JSONB field search                        |
| 2.4-INT-008  | Integration | P1       | Search by name (first/last)           | JSONB field search                        |
| 2.4-INT-009  | Integration | P1       | Combined search terms                  | OR query logic                            |
| 2.4-E2E-003  | E2E         | P0       | Real-time search filtering            | User experience validation                |

### AC4: Simple member list display

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-INT-010  | Integration | P0       | Fetch paginated member list           | Database query with limits                |
| 2.4-INT-011  | Integration | P1       | Sort members by creation date         | Query ordering                            |
| 2.4-INT-012  | Integration | P2       | Calculate current checkout count      | JSONB stats field accuracy                |
| 2.4-E2E-004  | E2E         | P1       | Navigate through paginated list       | UI pagination controls                    |

### AC5: Basic member details display

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-INT-013  | Integration | P0       | Fetch member profile by ID            | Single record retrieval                   |
| 2.4-INT-014  | Integration | P1       | Fetch member's active checkouts       | Join query functionality                  |
| 2.4-INT-015  | Integration | P2       | Display pending invitation status     | Cross-table data retrieval               |
| 2.4-E2E-005  | E2E         | P1       | View complete member profile          | Full profile rendering                    |

### AC6: Edit member personal information

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-006 | Unit        | P0       | Validate email format on edit         | Data integrity                            |
| 2.4-UNIT-007 | Unit        | P2       | Validate address fields               | Optional field validation                 |
| 2.4-INT-016  | Integration | P0       | Update member personal info           | JSONB field update                        |
| 2.4-INT-017  | Integration | P0       | Prevent duplicate email on edit       | Uniqueness constraint                     |
| 2.4-E2E-006  | E2E         | P1       | Edit and save member details          | Form submission flow                      |

### AC7: Edit member membership information

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-008 | Unit        | P1       | Validate membership type enum         | Data integrity                            |
| 2.4-INT-018  | Integration | P1       | Update membership status              | Status transition logic                   |
| 2.4-INT-019  | Integration | P2       | Update membership notes               | Text field update                         |
| 2.4-E2E-007  | E2E         | P2       | Change membership type                | UI dropdown interaction                   |

### AC8: All members default to "active" status

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-009 | Unit        | P0       | Default status in schema              | Schema default value                      |
| 2.4-INT-020  | Integration | P0       | New member has active status          | Database default verification             |

### AC9: Duplicate detection by email address

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-010 | Unit        | P0       | Email uniqueness validation           | Business rule validation                  |
| 2.4-INT-021  | Integration | P0       | Reject duplicate email on create      | Database constraint (DATA-002)            |
| 2.4-INT-022  | Integration | P0       | Allow same email across libraries     | Multi-tenant isolation                    |
| 2.4-E2E-008  | E2E         | P0       | Display duplicate email error         | User feedback on constraint violation     |

### AC10: No advanced features initially

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-011 | Unit        | P2       | Verify no fines calculation          | Feature boundary                          |
| 2.4-UNIT-012 | Unit        | P2       | Verify no limit enforcement          | Feature boundary                          |

### AC11: Mobile-responsive design

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-E2E-009  | E2E         | P1       | Member list on mobile viewport       | Responsive design validation              |
| 2.4-E2E-010  | E2E         | P1       | Member form on tablet viewport       | Form usability on medium screens         |
| 2.4-E2E-011  | E2E         | P2       | Touch interactions on mobile         | Mobile-specific interactions              |

### AC12: Restrict to librarian+ role

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                              |
|--------------|-------------|----------|-----------------------------------------|-------------------------------------------|
| 2.4-UNIT-013 | Unit        | P0       | Permission check logic                | Authorization rules                       |
| 2.4-INT-023  | Integration | P0       | Reject volunteer access to members    | RLS policy enforcement                    |
| 2.4-INT-024  | Integration | P0       | Allow librarian access to members     | Positive permission test                  |
| 2.4-E2E-012  | E2E         | P0       | Hide member menu for volunteers      | UI permission enforcement                 |
| 2.4-E2E-013  | E2E         | P0       | Access denied page for unauthorized  | Security boundary validation              |

## Risk Coverage Mapping

Tests specifically designed to mitigate identified risks:

| Risk ID  | Test Coverage                           | Mitigation Strategy                      |
|----------|----------------------------------------|------------------------------------------|
| DATA-001 | 2.4-INT-004 (concurrent ID generation) | Test with JMeter/load testing            |
| SEC-001  | 2.4-UNIT-005 (search sanitization)     | Parameterized query validation           |
| PERF-001 | Performance tests (separate suite)     | Load test with 1,500 members            |
| SEC-002  | Security audit (separate suite)        | Token entropy analysis                   |
| DATA-002 | 2.4-INT-022 (cross-library emails)     | Multi-tenant test scenarios              |
| BUS-001  | Compliance tests (future)              | Audit trail verification                 |

## Test Data Requirements

### Unit Tests
- Mock member objects with valid/invalid data
- Edge case values (empty strings, nulls, special characters)
- Boundary values for field lengths

### Integration Tests
- Test library with known ID
- Pre-seeded member records for search/update tests
- Clean database state between tests
- Mock Supabase client for isolated testing

### E2E Tests
- Test user accounts with different roles (librarian, volunteer)
- Realistic member data for registration
- Multiple libraries for cross-tenant testing
- Browser viewport configurations for responsive testing

## Recommended Execution Order

### Phase 1: Critical Path (P0 Tests)
1. Unit validation tests (2.4-UNIT-001 to 004, 009, 010, 013)
2. Core integration tests (2.4-INT-001 to 004, 020, 021, 023, 024)
3. Essential E2E journeys (2.4-E2E-001, 003, 008, 012, 013)

### Phase 2: Core Features (P1 Tests)
1. Search functionality (2.4-INT-006 to 009)
2. Member operations (2.4-INT-013, 014, 016, 018)
3. UI workflows (2.4-E2E-002, 004, 005, 006, 009, 010)

### Phase 3: Secondary Features (P2 Tests)
1. Optional field validations
2. Display enhancements
3. Mobile-specific interactions

## Test Automation Strategy

### Unit Tests (Jest)
- Run on every commit
- < 5 second execution time
- 100% deterministic
- No external dependencies

### Integration Tests (Jest + Supabase)
- Run on PR creation
- < 30 second execution time
- Use test containers for database
- Transaction rollback for cleanup

### E2E Tests (Playwright)
- Run before deployment
- < 5 minute execution time
- Parallel execution where possible
- Screenshot on failure

## Quality Gates

### Coverage Requirements
- Unit test coverage: ≥ 90% for validation logic
- Integration coverage: All API endpoints tested
- E2E coverage: All P0 user journeys tested

### Performance Criteria
- Search response: < 200ms for 1,000 members
- Form submission: < 500ms
- Page load: < 2 seconds

## Maintenance Considerations

### Test Stability
- Avoid brittle selectors in E2E tests
- Use data-testid attributes for element selection
- Implement proper wait strategies
- Mock external services where appropriate

### Test Data Management
- Use factories for consistent test data
- Clean up test data after execution
- Separate test data from production seeds
- Version control test fixtures

---

Test design matrix location: docs/qa/assessments/2.4.ultra-simple-member-management-test-design-20250110.md
P0 tests identified: 19