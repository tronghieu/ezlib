# Story 1.1: Project Setup and Core Infrastructure Next.js 15.5.2 project with shadcn/ui initialized

## Status
IN PROGRESS

## Story

**As a** developer,
**I want** to establish the Next.js 15+ project structure with essential dependencies and configuration,
**so that** the development team has a solid technical foundation for building the library management application.

## Acceptance Criteria

### **AC1: Next.js 15 Project Initialization**
1. Next.js 15.5.2 App Router project created as standalone application
2. Project uses latest React 19.1.0 with concurrent features
3. Tailwind CSS v4 configured with proper design system
4. shadcn/ui components integrated with New York variant
5. Source directory structure (`src/`) properly configured

### **AC2: TypeScript Configuration**
1. TypeScript 5.7.3 with strict mode enabled
2. Path aliases configured (`@/*` → `./src/*`)
3. Module resolution set to "bundler" for Next.js compatibility
4. Target ES2022 for modern JavaScript features
5. Proper type checking for all source files

### **AC3: Core Dependencies Installation**
1. shadcn/ui component system with Radix UI primitives
2. Tailwind CSS v4 with animation utilities
3. Supabase client libraries (@supabase/supabase-js, @supabase/ssr)
4. State management (React Query @tanstack/react-query, Zustand)
5. Form validation (React Hook Form, Zod, @hookform/resolvers)

### **AC4: Code Quality Tools**
1. ESLint 9 configured with Next.js rules
2. Prettier 3.6.2 with consistent formatting
3. Git hooks for pre-commit validation using Husky
4. EditorConfig for cross-editor consistency
5. Linting and formatting commands functional

### **AC5: Project Structure Implementation**
1. `src/app/` directory with App Router structure
2. `src/components/ui/` with shadcn/ui components
3. `src/lib/` with organized subdirectories (auth/, supabase/, services/, utils/, validation/)
4. `src/hooks/`, `src/store/`, `src/types/` directories
5. Public assets directory properly configured

### **AC6: Build Configuration**
1. Next.js build configuration optimized for production
2. TypeScript build process properly configured
3. Environment-specific build scripts (dev, build, start)
4. Static asset optimization configured
5. API routes properly configured for serverless deployment

### **AC7: Environment Configuration**
1. `.env.local` file created with required variables
2. `.env.example` template documented with all necessary variables
3. Supabase connection variables configured (URL, anon key, service role key)
4. Feature flags for MVP progression (due dates, fines, holds, advanced search)
5. Environment validation utility for startup checks

### **AC8: Health Check Endpoint**
1. `/api/health` route implementation returning system status
2. Database connectivity validation to Supabase instance
3. Environment configuration completeness check
4. System timestamp and version information in response
5. Proper HTTP status codes (200 for healthy, 503 for unhealthy)

## Tasks / Subtasks

- [x] **Task 1: Initialize Project with shadcn/ui Integrated Setup** (AC: 1, 2, 3, 5)
  - [x] Navigate to `apps/` directory within monorepo
  - [x] Run `pnpm dlx shadcn@latest init` to create Next.js 14 project with integrated setup
  - [x] Configure project name as `library-management` during setup
  - [x] Follow shadcn prompts to configure:
    - TypeScript enabled with strict mode
    - Tailwind CSS with proper configuration
    - App Router structure (src/ directory)
    - Path aliases (`@/*` → `./src/*`)
    - Components directory structure (`src/components/ui/`)
  - [x] Verify Next.js 14 App Router is properly configured
  - [x] Confirm TypeScript strict mode settings in tsconfig.json

- [x] **Task 2: Install Initial shadcn/ui Components** (AC: 3, 5)
  - [x] Add core UI components: `pnpm dlx shadcn@latest add button input table card dialog`
  - [x] Add layout components: `pnpm dlx shadcn@latest add dropdown-menu label sonner` (updated sonner instead of deprecated toast)
  - [x] Add form components: `pnpm dlx shadcn@latest add checkbox select textarea`
  - [x] Verify components are properly installed in `src/components/ui/`
  - [x] Test basic component import and usage

- [x] **Task 3: Install Additional Required Dependencies** (AC: 3)
  - [x] Install Supabase client libraries (@supabase/supabase-js, @supabase/ssr - updated to latest recommended)
  - [x] Install state management (React Query @tanstack/react-query, Zustand)
  - [x] Install form management (React Hook Form, @hookform/resolvers, Zod)
  - [x] Install UI enhancement libraries (Framer Motion, Lucide Icons already included, Sonner already included)
  - [x] Verify all dependencies are compatible with Next.js 15 (successful build test)

- [x] **Task 4: Complete Source Tree Structure Setup** (AC: 5)
  - [x] Verify shadcn setup created proper `src/app/` and `src/components/ui/` directories
  - [x] Create additional required directories:
    - [x] `src/lib/` with subdirectories (auth/, supabase/, services/, utils/, validation/)
    - [x] `src/types/` for TypeScript definitions
    - [x] `src/hooks/` for custom React hooks
    - [x] `src/store/` for Zustand stores
  - [x] Add `public/` directory for static assets (already created by shadcn)
  - [x] Create initial `src/app/layout.tsx` with basic metadata setup

- [ ] **Task 5: Configure Code Quality Tools** (AC: 4)
  - [ ] Verify ESLint configuration from shadcn setup
  - [ ] Add Prettier configuration with consistent formatting rules
  - [ ] Install and configure lint-staged and Husky for pre-commit hooks
  - [ ] Add editor settings (.editorconfig) for consistency
  - [ ] Test linting and formatting workflows

- [ ] **Task 6: Configure Build Process** (AC: 6)
  - [ ] Optimize Next.js build configuration for production
  - [ ] Set up TypeScript build process with proper output
  - [ ] Configure environment-specific build scripts in package.json
  - [ ] Set up static asset optimization and caching
  - [ ] Test production build process

- [ ] **Task 7: Environment Configuration** (AC: 7)
  - [ ] Create `.env.example` with all required environment variables
  - [ ] Set up Supabase configuration variables (URL, anon key, service role key)
  - [ ] Add Next.js configuration variables (site URL, auth URL)
  - [ ] Configure crawler service integration variables
  - [ ] Add feature flag variables for MVP progression
  - [ ] Document environment setup in README

- [ ] **Task 8: Create Health Check Endpoint** (AC: 8)
  - [ ] Create `src/app/api/health/route.ts` API route
  - [ ] Implement database connectivity test via Supabase client
  - [ ] Return comprehensive system status (database connection, environment config)
  - [ ] Include timestamp and version information
  - [ ] Add proper error handling and HTTP status codes

## Dev Notes

### Technical Architecture Context

This story establishes the foundation for the **EzLib Library Management System**, an **ultra-simple MVP** administrative web application that will serve small/medium libraries (1-3 staff, up to 5K books, 1K members) with **dashboard-centric, search-first** interface design.

[Source: docs/frontend-architecture.md#Introduction]

### Architecture Principles

- **Ultra-Simple First**: Start with basic functionality, add complexity incrementally
- **Search-First Interface**: Prominent search across all data types with autocomplete
- **Dashboard-Centric Navigation**: Operational overview with quick access to common tasks
- **Real-time Synchronization**: Live inventory updates between admin and reader apps
- **Mobile-Responsive Admin**: Tablet-optimized for circulation desk operations
- **Cross-Domain Authentication**: Independent login sessions with future session sharing

[Source: docs/frontend-architecture.md#Architecture Principles]

### Core Technology Stack

| Technology       | Version | Purpose                         | Rationale                                                           |
| ---------------- | ------- | ------------------------------- | ------------------------------------------------------------------- |
| **Next.js**      | 14+     | React framework with App Router | Server-side rendering, optimal admin performance, Vercel deployment |
| **TypeScript**   | 5.0+    | Type safety                     | Strict mode, error prevention, developer productivity               |
| **shadcn/ui**    | Latest  | Component system                | Professional admin interface, accessibility, customization          |
| **Tailwind CSS** | 3.4+    | Utility-first CSS               | Rapid development, consistent design, responsive by default         |
| **Supabase**     | Latest  | PostgreSQL BaaS                 | Real-time subscriptions, Row Level Security, direct connection      |
| **React Query**  | Latest  | Server state management         | Optimized caching for admin operations                              |
| **Zustand**      | Latest  | Client state management         | Lightweight UI state                                                |

[Source: docs/architecture/tech-stack.md#Frontend Stack]

### Required Project Structure

```plaintext
apps/library-management/
├── src/
│   ├── app/                           # Next.js 14 App Router
│   │   ├── (auth)/                    # Authentication group
│   │   ├── (admin)/                   # Admin-protected routes
│   │   ├── api/                       # API routes (minimal)
│   │   ├── globals.css                # Global styles with admin theme
│   │   ├── layout.tsx                 # Root layout with providers
│   │   ├── loading.tsx                # Global loading states
│   │   └── not-found.tsx              # 404 handling
│   ├── components/                    # Shared React components
│   │   ├── ui/                        # shadcn/ui base components
│   │   ├── layout/                    # Layout components
│   │   └── [feature]/                 # Feature-specific components
│   ├── lib/                           # Core utilities
│   │   ├── auth/                      # Authentication logic
│   │   ├── supabase/                  # Database client
│   │   ├── services/                  # Business logic services
│   │   ├── validation/                # Zod schemas
│   │   └── utils.ts                   # Common utilities
│   ├── hooks/                         # Custom React hooks
│   ├── store/                         # Zustand stores
│   └── types/                         # TypeScript definitions
```

[Source: docs/architecture/source-tree.md#Source Code Structure]

### TypeScript Configuration Requirements

- **Strict Mode**: Enable all strict TypeScript options for error prevention
- **Path Aliases**: Configure `@/*` to point to `./src/*` for clean imports
- **Module Resolution**: Use "bundler" for Next.js 14 compatibility
- **Target**: ES2022 for modern browser support

[Source: docs/architecture/coding-standards.md#TypeScript Standards]

### shadcn/ui Integrated Setup Process

The recommended approach uses the official shadcn/ui Next.js installation guide (https://ui.shadcn.com/docs/installation/next):

1. **Single Init Command**: `pnpm dlx shadcn@latest init`
   - Creates Next.js 14 project with App Router
   - Configures TypeScript with strict mode
   - Sets up Tailwind CSS with proper configuration
   - Establishes component directory structure
   - Configures path aliases automatically

2. **Component Installation**: `pnpm dlx shadcn@latest add [component-name]`
   - Installs components with all required dependencies
   - Handles Radix UI primitives automatically
   - Sets up proper CSS and utility classes

3. **Additional Dependencies to Install Separately**:

```json
{
  "dependencies": {
    "@supabase/auth-helpers-nextjs": "^0.8.7",
    "@supabase/supabase-js": "^2.38.4",
    "@tanstack/react-query": "^5.8.4",
    "framer-motion": "^10.16.5",
    "react-hook-form": "^7.48.2",
    "sonner": "^1.2.4",
    "zod": "^3.22.4",
    "zustand": "^4.4.7"
  }
}
```

[Source: https://ui.shadcn.com/docs/installation/next + docs/architecture/tech-stack.md#Package Dependencies]

### Environment Variables Configuration

```bash
# Next.js Configuration
NEXT_PUBLIC_SITE_URL=https://manage.ezlib.com
NEXT_PUBLIC_READER_APP_URL=https://ezlib.com

# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your-supabase-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key

# Cross-Domain Authentication
NEXTAUTH_SECRET=your-nextauth-secret
NEXTAUTH_URL=https://manage.ezlib.com

# Book Crawler Integration
NEXT_PUBLIC_CRAWLER_API_URL=http://localhost:8000
CRAWLER_SERVICE_AUTH_SECRET=your-crawler-auth-secret

# Feature Flags (MVP Progression)
NEXT_PUBLIC_ENABLE_DUE_DATES=false
NEXT_PUBLIC_ENABLE_FINES=false
NEXT_PUBLIC_ENABLE_HOLDS=false
NEXT_PUBLIC_ENABLE_ADVANCED_SEARCH=false
```

[Source: docs/architecture/tech-stack.md#Environment Configuration]

### Health Check Implementation Requirements

The health check endpoint must validate:

- Database connectivity to shared Supabase instance at monorepo root
- Environment configuration completeness
- System timestamp and version information
- Proper error handling with descriptive messages

### Project Context

This is a standalone Next.js application that will:

- **Connect to Supabase**: Direct database connection for all data operations
- **Integrate with external services**: Future integration with book metadata enrichment APIs
- **Support multi-library operations**: Each library operates independently with data isolation

### Testing

#### Testing Standards

- **Framework**: Jest with Testing Library for component tests
- **E2E Testing**: Playwright for critical workflows
- **Test Location**: All tests in `tests/` directory mirroring `src/` structure
- **Coverage**: Minimum 80% coverage for services and hooks
- **Component Testing**: Focus on user interactions and accessibility

[Source: docs/architecture/coding-standards.md#Testing Standards]

#### Testing Requirements for This Story

- Unit tests for health check endpoint functionality
- Integration tests for environment configuration validation
- Build process verification tests

## Change Log

| Date       | Version | Description                                                              | Author     |
| ---------- | ------- | ------------------------------------------------------------------------ | ---------- |
| 2025-08-26 | 1.1     | Updated to follow official shadcn/ui Next.js installation guide workflow | Sarah (PO) |
| 2025-08-26 | 1.0     | Initial story creation from Epic 1.1 requirements                        | Sarah (PO) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_To be filled by QA agent after implementation_
